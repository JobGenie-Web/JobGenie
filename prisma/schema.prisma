generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// CORE USER MANAGEMENT
// ============================================

model User {
  id                            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                         String    @unique @db.VarChar(255)
  password                      String   @db.VarChar(255)
  role                          UserRole
  status                        UserStatus @default(pending_verification)
  
  // OAuth fields
  provider                      String?   @db.VarChar(50)
  provider_id                   String?   @db.VarChar(255)
  
  // Security & verification
  email_verified                Boolean   @default(false)
  email_verification_token      String?   @db.VarChar(255)
  verification_token_expires_at DateTime?
  password_reset_token          String?   @db.VarChar(255)
  password_reset_expires_at     DateTime?
  invitation_token              String?   @unique
  invitation_token_expires_at   DateTime?
  invited_by                    String?
  
  // Metadata
  last_login_at                 DateTime?
  created_at                    DateTime  @default(now())
  updated_at                    DateTime  @updatedAt
  deleted_at                    DateTime?
  
  // Relations
  candidate                     Candidate?
  employer                      Employer?
  mis_user                      MisUser?
  
  @@index([email])
  @@index([role, status])
  @@index([deleted_at])
  @@map("users")
}

// ============================================
// CANDIDATE PROFILE
// ============================================

model Candidate {
  id                      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                 String   @unique @db.Uuid
  
  // Basic Information (Section 1)
  first_name              String   @db.VarChar(100)
  last_name               String   @db.VarChar(100)
  nicPassport             String   @db.VarChar(20)
  dob                     DateTime @db.Date
  contact_no              String   @db.VarChar(20)
  email                   String   @unique @db.VarChar(255)
  gender                  Gender
  current_position        String   @db.VarChar(200)
  industry                String   @db.VarChar(100)
  address                 String   @db.Text
  phone                   String   @db.VarChar(20)
  alternative_phone       String?  @db.VarChar(20)
  country                 String?  @db.VarChar(100)
  membership_no           String?  @db.VarChar(20)
  resume_url              String?  @db.VarChar(255)
  resume_copy_url         String?  @db.VarChar(255)
  
  years_of_experience     Int?      @default(0)
  experience_level        ExperienceLevel? @default(entry)
  
  // Qualifications stored as array for multiple selection
  qualifications          ProfessionalQualification[]
  
  expected_monthly_salary Decimal? @db.Decimal(12, 2)
  availability_status     AvailabilityStatus? @default(available)
  notice_period           String?  @db.VarChar(50) // e.g., "immediate", "1 month", "2 months"
  employment_type         EmploymentType? @default(full_time)
  
  professional_summary    String?  @db.VarChar(1000)
  profile_image_url       String?  @db.VarChar(255)
  
  approval_status         ApprovalStatus @default(pending)
  profile_completed       Boolean @default(false)
  
  // Approval workflow tracking
  approval_status_message_seen Boolean @default(false)
  approved_at             DateTime?
  rejected_at             DateTime?
  reviewed_by             String?  @db.Uuid
  rejection_reason        String?  @db.Text
  
  // Metadata
  created_at              DateTime @default(now())
  updated_at              DateTime @updatedAt
  
  // Relations
  user                    User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  reviewer                MisUser? @relation(fields: [reviewed_by], references: [user_id], onDelete: SetNull)
  work_experiences        WorkExperience[]
  educations              Education[]
  awards                  Award[]
  projects                Project[] // IT industry
  certificates            Certificate[] // IT industry
  
  // Industry-specific education
  finance_academic_education      FinanceAcademicEducation[]
  finance_professional_education  FinanceProfessionalEducation[]
  banking_academic_education      BankingAcademicEducation[]
  banking_professional_education  BankingProfessionalEducation[]
  banking_specialized_training    BankingSpecializedTraining[]
  
  // Universal - works across all industries
  industry_specializations IndustrySpecialization[]
  
  @@index([user_id])
  @@index([industry])
  @@index([experience_level])
  @@index([availability_status])
  @@index([country])
  @@index([approval_status])
  @@map("candidates")
}

// ============================================
// CANDIDATE EXPERIENCE (Section 2)
// ============================================

model WorkExperience {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id    String   @db.Uuid
  
  job_title       String?   @db.VarChar(200)
  company         String?   @db.VarChar(200)
  employment_type EmploymentType? @default(full_time)
  location        String?  @db.VarChar(200)
  location_type   LocationType? @default(onsite)
  
  start_date      DateTime? @db.Date
  end_date        DateTime? @db.Date
  description     String?  @db.Text
  is_current      Boolean?  @default(false)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@index([is_current])
  @@index([start_date])
  @@map("work_experiences")
}

// ============================================
// CANDIDATE EDUCATION (Section 3)
// ============================================

model Education {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id    String   @db.Uuid
  
  education_type  EducationType @default(academic) // academic or professional
  degree_diploma  String?   @db.VarChar(200) // Qualification
  professional_qualification String?   @db.VarChar(200)
  institution     String?   @db.VarChar(200)
  status          EducationStatus @default(incomplete)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@index([education_type])
  @@map("educations")
}

// ============================================
// AWARDS & ACHIEVEMENTS (Section 4)
// ============================================

model Award {
  id                  String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id        String   @db.Uuid
  
  nature_of_award     String?   @db.VarChar(300)
  offered_by          String?   @db.VarChar(200)
  description         String?  @db.Text
  
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  
  candidate           Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@map("awards")
}

// ============================================
// IT INDUSTRY SPECIFIC - PROJECTS (Section 5)
// ============================================

model Project {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id    String   @db.Uuid
  
  project_name    String?   @db.VarChar(200)
  description     String?  @db.Text
  demo_url        String?  @db.VarChar(500) // Demo/Github URL
  is_current      Boolean  @default(false)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@index([is_current])
  @@map("projects")
}

// ============================================
// IT INDUSTRY SPECIFIC - CERTIFICATES (Section 6)
// ============================================

model Certificate {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id        String    @db.Uuid
  
  certificate_name    String?    @db.VarChar(200)
  issuing_authority   String?    @db.VarChar(200)
  issue_date          DateTime? @db.Date
  expiry_date         DateTime? @db.Date
  credential_id       String?   @db.VarChar(100)
  credential_url      String?   @db.VarChar(500)
  description         String?   @db.Text
  
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  
  candidate           Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@index([issue_date])
  @@index([expiry_date])
  @@map("certificates")
}

// ============================================
// FINANCE INDUSTRY - EDUCATION
// ============================================

model FinanceAcademicEducation {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id    String   @db.Uuid
  
  degree_diploma  String   @db.VarChar(200) // Degree/Diploma/Postgraduate Diploma – Accounting and Finance
  institution     String   @db.VarChar(200)
  status          FinanceEducationStatus @default(incomplete)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@map("finance_academic_education")
}

model FinanceProfessionalEducation {
  id                          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id                String   @db.Uuid
  
  professional_qualification  String   @db.VarChar(300) // Professional Qualifications/Professional Programs/Specialized programs
  institution                 String   @db.VarChar(200)
  status                      FinanceEducationStatus @default(incomplete)
  
  created_at                  DateTime @default(now())
  updated_at                  DateTime @updatedAt
  
  candidate                   Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@map("finance_professional_education")
}

// ============================================
// BANKING INDUSTRY - EDUCATION
// ============================================

model BankingAcademicEducation {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id    String   @db.Uuid
  
  degree_diploma  String   @db.VarChar(200) // Degree/Diploma/Postgraduate Diploma – Banking and Finance
  institution     String   @db.VarChar(200)
  status          BankingEducationStatus @default(incomplete)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@map("banking_academic_education")
}

model BankingProfessionalEducation {
  id                          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id                String   @db.Uuid
  
  professional_qualification  String   @db.VarChar(300) // Professional Banking Programs/Specialist diplomas/International Professional Qualifications
  institution                 String   @db.VarChar(200)
  status                      BankingEducationStatus @default(incomplete)
  
  created_at                  DateTime @default(now())
  updated_at                  DateTime @updatedAt
  
  candidate                   Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@map("banking_professional_education")
}

model BankingSpecializedTraining {
  id                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id            String    @db.Uuid
  
  certificate_name        String    @db.VarChar(300) // Certificate Name/Training program name
  issuing_authority       String    @db.VarChar(200) // Issuing Authority/Institution
  certificate_issue_month DateTime? @db.Date         // Certificate Issue Month/training completion month
  status                  BankingEducationStatus @default(incomplete)
  
  created_at              DateTime  @default(now())
  updated_at              DateTime  @updatedAt
  
  candidate               Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@index([certificate_issue_month])
  @@map("banking_specialized_training")
}

// ============================================
// UNIVERSAL - INDUSTRY SPECIALIZATION
// ============================================

model IndustrySpecialization {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidate_id    String   @db.Uuid
  
  industry        IndustryType
  specialization  String   @db.VarChar(200)  // e.g., "Mobile Development", "Trade Finance"
  description     String?  @db.Text
  years_experience Int?    @default(0)
  
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  
  @@index([candidate_id])
  @@index([industry])
  @@map("industry_specializations")
}

// ============================================
// EMPLOYER & COMPANY
// ============================================

model Company {
  id                          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  
  // Company Information (Section 1)
  company_name                String   @db.VarChar(200)
  business_registration_no    String   @unique @db.VarChar(50)
  industry                    String   @db.VarChar(100)
  bio                         String?  @db.VarChar(255)
  business_registered_address String   @db.VarChar(255)
  br_certificate_url          String   @db.VarChar(255)// BR Certificate URL
  logo_url                    String?  @db.VarChar(255)
  description                 String?  @db.VarChar(5000)
  phone                       String   @db.VarChar(20)
  website                     String?  @db.VarChar(255)
  headoffice_location         String?  @db.VarChar(200)
  company_size                String?  @db.VarChar(50)
  specialities                String[] @default([])  // Array of specialities
  map_link                    String?  @db.VarChar(1000)
  
  approval_status             ApprovalStatus @default(pending)
  profile_completed           Boolean @default(false)
  
  created_at                  DateTime @default(now())
  updated_at                  DateTime @updatedAt
  
  // Relations
  employers                   Employer[]
  jobs                        Job[]
  
  @@index([business_registration_no])
  @@index([industry])
  @@index([approval_status])
  @@map("companies")
}

model Employer {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id     String   @unique @db.Uuid
  company_id  String   @db.Uuid
  

  first_name  String   @db.VarChar(100)
  last_name   String   @db.VarChar(100)
  designation String?  @db.VarChar(200)
  phone       String?  @db.VarChar(20)
  email       String   @db.VarChar(255)
  address     String   @db.VarChar(255)
  job_title   String?  @db.VarChar(200)
  department  String?  @db.VarChar(100)
  is_super_admin Boolean @default(false)
  profile_completed Boolean @default(false)
  profile_image_url String? @db.VarChar(255)
  
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  
  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  company     Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  jobs        Job[]
  
  @@index([user_id])
  @@index([company_id])
  @@map("employers")
}

// ============================================
// MIS USER
// ============================================

model MisUser {
  user_id        String             @id @db.Uuid
  first_name     String            @db.VarChar(100)
  last_name      String            @db.VarChar(100)
  email          String             @unique @db.VarChar(255)
  created_at     DateTime           @default(now())
  updated_at     DateTime           @updatedAt
  user           User               @relation(fields: [user_id], references: [id], onDelete: Cascade)
  reviewed_candidates Candidate[]

  @@map("mis_user")
}

// ============================================
// JOB MANAGEMENT
// ============================================

model Job {
  id                      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employer_id             String   @db.Uuid
  company_id              String   @db.Uuid
  
  // Job Information
  job_title               String   @db.VarChar(200)
  location                String?  @db.VarChar(200)
  industry                String?  @db.VarChar(100)
  deadline                DateTime? @db.Date
  job_type                JobType  @default(full_time)
  advertisement_link      String?  @db.VarChar(500)
  
  description             String?  @db.Text
  status                  JobStatus @default(draft)
  
  created_at              DateTime @default(now())
  updated_at              DateTime @updatedAt
  published_at            DateTime?
  
  employer                Employer @relation(fields: [employer_id], references: [id], onDelete: Cascade)
  company                 Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  
  @@index([employer_id])
  @@index([company_id])
  @@index([status])
  @@index([job_type])
  @@index([industry])
  @@index([published_at])
  @@index([deadline])
  @@map("jobs")
}

// ============================================
// ENUMS
// ============================================

enum UserRole {
  candidate
  employer
  mis
}

enum UserStatus {
  active
  inactive
  suspended
  pending_verification
}

enum ExperienceLevel {
  entry
  junior
  mid
  senior
}

enum Gender {
  male
  female
  other
}

enum ProfessionalQualification {
  bachelors_degree
  masters_degree
  doctorate_phd
  undergraduate
  post_graduate
  diploma
  certificate
  professional_certification
  vocational_training
  no_formal_education
}

enum AvailabilityStatus {
  available
  open_to_opportunities
  not_looking
}

enum EmploymentType {
  full_time
  part_time
  contract
  internship
  freelance
  volunteer
}

enum LocationType {
  remote
  hybrid
  onsite
}

enum EducationType {
  academic
  professional
}

enum EducationStatus {
  incomplete
  first_class
  second_class_upper
  second_class_lower
  general
}

enum ApprovalStatus {
  pending
  approved
  rejected
}

enum JobType {
  full_time
  part_time
  contract
  internship
  freelance
}

enum JobStatus {
  draft
  published
  paused
  closed
  archived
}

// ============================================
// FINANCE & BANKING EDUCATION STATUS ENUMS
// ============================================

enum FinanceEducationStatus {
  incomplete
  first_class
  second_class_upper
  second_class_lower
  general
}

enum BankingEducationStatus {
  incomplete
  first_class
  second_class_upper
  second_class_lower
  general
}

enum IndustryType {
  it_software
  banking
  finance_investment
}